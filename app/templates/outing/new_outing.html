{% extends "base.html" %}

{% block styles %}
    {{ super() }}
    <script>
    document.addEventListener("DOMContentLoaded", function(){
        let season_selector = document.getElementById("season_selector");
        let game_selector = document.getElementById("game_selector");

        season_selector.onchange = function(){
            season = season_selector.value;
            console.log(season);

            fetch(
                "/api/season/" + season + "/games",
            ).then(res => res.json())
            .then(function(response){
                // check to make sure that server stuff happened ok
                if(response.status == "failure"){
                    console.log("Request ended in failure");
                    console.log("Error: " + response.error);
                } else {
                    // create element for each item in response
                    let options = "<option value=''> </option>";
                    for(let game of response.games){
                        // create html element string
                        options += "<option value='" + game.id +"'>" + game.label + "</option>";
                    }
                    // replace current options html with our options html
                    game_selector.innerHTML = options;
                }
            });
        }
    });
    
    </script>
{% endblock %}

{% block app_content %}
    <div class="main">
        <h1>New Outing</h1>
        <form method="post" novalidate>
            {{ form.hidden_tag() }}
            <p>
                {{ form.pitcher.label }}<br>
                {{ form.pitcher }}<br>
                {% for error in form.pitcher.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
            <p>
                {{ form.date.label }}<br>
                {{ form.date(class='datepicker') }}<br>
                If in safari, enter date as YYYY-MM-DD
                {% for error in form.date.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
            <p>
                {{ form.opponent.label }}<br>
                {{ form.opponent() }}<br>
                {% for error in form.opponent.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
            <p>
                {{ form.season.label }}<br>
                {{ form.season(id="season_selector") }}<br>
                {% for error in form.season.errors %}
                    <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
            <p>
                {{ form.game.label }} <br>
                {{ form.game(id="game_selector") }}
                {% for error in form.game.errors %}
                    <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
            <br>
            <p>{{ form.submit() }}</p>
        </form>
        <p>OR</p>
        <button><a href="{{ url_for('outing.new_outing_pitch_tracker') }}">Track Live</a></button>
    </div>
{% endblock %}